<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAP INVADERS: Contact Protocol</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #00ff00;
            font-family: 'Courier Prime', monospace;
            overflow: hidden;
            cursor: none;
        }
        
        body.windowed {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background: #1a1a1a;
        }
        
        .title {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            padding: 10px 20px;
            margin: 10px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
        }
        
        .star-border {
            color: #00ff00;
            font-size: 20px;
            margin: 5px 0;
        }
        
        #gameCanvas {
            border: 2px solid #444;
            background: #000;
            display: block;
            cursor: crosshair;
        }
        
        body:not(.windowed) #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw !important;
            height: 100vh !important;
        }
        
        .ui {
            display: flex;
            justify-content: space-between;
            width: 800px;
            padding: 10px 20px;
            background: #2a2a2a;
            border: 2px solid #444;
            margin-top: 10px;
            position: relative;
            z-index: 10;
        }
        
        body:not(.windowed) .ui {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100vw;
            margin: 0;
            background: rgba(42, 42, 42, 0.9);
        }
        
        .status-bar {
            background: #444;
            height: 8px;
            margin: 2px 0;
        }
        
        .health-bar {
            background: #ff4444;
        }
        
        .energy-bar {
            background: #44ff44;
        }
        
        .score-bar {
            background: #4444ff;
        }
        
        .controls {
            text-align: center;
            margin: 10px;
            font-size: 14px;
            color: #aaa;
            position: relative;
            z-index: 10;
        }
        
        body:not(.windowed) .controls {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        
        .menu-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #00ff00;
        }
        
        .menu-title {
            font-size: 48px;
            margin-bottom: 30px;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .callsign-input {
            background: #333;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier Prime', monospace;
            font-size: 18px;
            padding: 10px;
            margin: 10px;
            text-align: center;
            width: 300px;
        }
        
        .menu-button {
            background: #333;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier Prime', monospace;
            font-size: 16px;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .menu-button:hover {
            background: #00ff00;
            color: #000;
        }
        
        .high-scores {
            margin-top: 30px;
            text-align: center;
        }
        
        .high-scores h3 {
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .score-entry {
            display: flex;
            justify-content: space-between;
            width: 300px;
            margin: 5px 0;
            padding: 5px;
            background: #222;
        }
        
        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2a2a2a;
            border: 3px solid #00ff00;
            padding: 30px;
            text-align: center;
            display: none;
            z-index: 1000;
            color: #00ff00;
        }
        
        .fullscreen-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #333;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier Prime', monospace;
            font-size: 14px;
            padding: 5px 10px;
            cursor: pointer;
            z-index: 100;
        }
        
        .fullscreen-btn:hover {
            background: #00ff00;
            color: #000;
        }
    </style>
</head>
<body class="windowed">
    <button class="fullscreen-btn" id="fullscreenBtn">FULLSCREEN</button>
    
    <!-- Menu Screen -->
    <div class="menu-screen" id="menuScreen">
        <div class="menu-title">üõ∏ UAP INVADERS üõ∏</div>
        <div style="margin-bottom: 20px; text-align: center;">
            <div>CONTACT PROTOCOL ACTIVATED</div>
            <div style="font-size: 14px; color: #888; margin-top: 5px;">Enter your callsign, pilot</div>
        </div>
        
        <input type="text" class="callsign-input" id="callsignInput" placeholder="ENTER CALLSIGN" maxlength="10">
        <button class="menu-button" id="startBtn">START MISSION</button>
        <button class="menu-button" id="showScoresBtn">HIGH SCORES</button>
        
        <div class="high-scores" id="highScores" style="display: none;">
            <h3>üèÜ TOP PILOTS üèÜ</h3>
            <div id="scoresList"></div>
            <button class="menu-button" id="backBtn">BACK</button>
        </div>
    </div>
    
    <div class="star-border">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
    <div class="title">**CONTACT PROTOCOL**</div>
    <div class="star-border">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div class="ui">
        <div>
            <div>CALLSIGN: <span id="currentCallsign">UNKNOWN</span></div>
            <div>SCORE: <span id="score">0</span></div>
            <div class="status-bar score-bar" style="width: 100px;" id="scoreBar"></div>
        </div>
        <div>
            <div>HEALTH: <span id="health">100</span>%</div>
            <div class="status-bar health-bar" style="width: 100px;" id="healthBar"></div>
        </div>
        <div>
            <div>ENERGY: <span id="energy">100</span>%</div>
            <div class="status-bar energy-bar" style="width: 100px;" id="energyBar"></div>
        </div>
        <div style="text-align: center;">
            <div>*CONTACT* *PROTOCOL*</div>
            <div>üöÄ</div>
        </div>
    </div>
    
    <div class="controls">
        Move MOUSE to navigate ‚Ä¢ LEFT CLICK to fire ‚Ä¢ F11 for fullscreen ‚Ä¢ Intercept the UAPs!
    </div>
    
    <div class="game-over" id="gameOver">
        <h2>MISSION COMPLETE!</h2>
        <p>Pilot: <span id="finalCallsign">UNKNOWN</span></p>
        <p>Final Score: <span id="finalScore">0</span></p>
        <p id="newRecord" style="color: #ffd700; display: none;">üèÜ NEW RECORD! üèÜ</p>
        <button class="menu-button" id="restartBtn">NEW MISSION</button>
        <button class="menu-button" id="menuBtn">MAIN MENU</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game state
        let gameRunning = false;
        let gameStarted = false;
        let score = 0;
        let health = 100;
        let energy = 100;
        let currentCallsign = '';
        let isFullscreen = false;
        let mouseX = 0;
        let mouseY = 0;
        
        // Player
        const player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 30,
            height: 30,
            speed: 8
        };
        
        // Arrays for game objects
        let bullets = [];
        let enemies = [];
        let stars = [];
        let explosions = [];
        
        // UAP types with different behaviors
        const uapTypes = [
            { emoji: 'üõ∏', name: 'Classic Saucer', points: 10, speed: 1, size: 30 },
            { emoji: 'üõ∞Ô∏è', name: 'Probe', points: 15, speed: 2, size: 25 },
            { emoji: '‚ö°', name: 'Tic Tac', points: 25, speed: 3, size: 20 },
            { emoji: 'üî•', name: 'Phoenix Light', points: 30, speed: 1.5, size: 35 },
            { emoji: 'üí´', name: 'Orb', points: 20, speed: 2.5, size: 22 },
            { emoji: 'üåÄ', name: 'Vortex', points: 40, speed: 1, size: 40 }
        ];
        
        // High scores system
        let highScores = JSON.parse(localStorage.getItem('uapInvadersScores')) || [];
        
        // Generate background stars
        function generateStars() {
            stars = [];
            const starCount = isFullscreen ? 300 : 150;
            for (let i = 0; i < starCount; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    speed: Math.random() * 0.8 + 0.2,
                    brightness: Math.random() * 0.8 + 0.2
                });
            }
        }
        
        // Initialize game
        function initGame() {
            resizeCanvas();
            generateStars();
            
            // Menu event listeners
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('showScoresBtn').addEventListener('click', showHighScores);
            document.getElementById('backBtn').addEventListener('click', showMenu);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            document.getElementById('menuBtn').addEventListener('click', showMenu);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            
            // Callsign input
            document.getElementById('callsignInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    startGame();
                }
            });
            
            displayHighScores();
        }
        
        // Resize canvas for fullscreen
        function resizeCanvas() {
            if (isFullscreen) {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            } else {
                canvas.width = 800;
                canvas.height = 600;
            }
            player.x = canvas.width / 2;
            player.y = canvas.height - 50;
        }
        
        // Fullscreen toggle
        function toggleFullscreen() {
            // Note: In Electron, we'll use the window controls instead
            if (typeof require !== 'undefined') {
                // Running in Electron
                const { ipcRenderer } = require('electron');
                // Send message to main process to toggle fullscreen
                // This would be handled by the main process
                return;
            }
            
            if (!isFullscreen) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
                document.body.classList.remove('windowed');
                isFullscreen = true;
                document.getElementById('fullscreenBtn').textContent = 'WINDOWED';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
                document.body.classList.add('windowed');
                isFullscreen = false;
                document.getElementById('fullscreenBtn').textContent = 'FULLSCREEN';
            }
            resizeCanvas();
            generateStars();
        }
        
        // Show menu
        function showMenu() {
            gameRunning = false;
            gameStarted = false;
            document.getElementById('menuScreen').style.display = 'flex';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('highScores').style.display = 'none';
        }
        
        // Start game
        function startGame() {
            const callsignInput = document.getElementById('callsignInput');
            currentCallsign = callsignInput.value.trim().toUpperCase() || 'UNKNOWN';
            
            if (currentCallsign === 'UNKNOWN') {
                alert('Please enter a callsign, pilot!');
                return;
            }
            
            document.getElementById('currentCallsign').textContent = currentCallsign;
            document.getElementById('menuScreen').style.display = 'none';
            
            // Reset game state
            score = 0;
            health = 100;
            energy = 100;
            bullets = [];
            enemies = [];
            explosions = [];
            player.x = canvas.width / 2;
            player.y = canvas.height - 50;
            
            gameRunning = true;
            gameStarted = true;
            updateUI();
        }
        
        // Show high scores
        function showHighScores() {
            document.getElementById('highScores').style.display = 'block';
        }
        
        // Display high scores
        function displayHighScores() {
            const scoresList = document.getElementById('scoresList');
            scoresList.innerHTML = '';
            
            highScores.slice(0, 10).forEach((entry, index) => {
                const scoreEntry = document.createElement('div');
                scoreEntry.className = 'score-entry';
                scoreEntry.innerHTML = `
                    <span>${index + 1}. ${entry.callsign}</span>
                    <span>${entry.score}</span>
                `;
                scoresList.appendChild(scoreEntry);
            });
        }
        
        // Save high score
        function saveHighScore() {
            const newScore = { callsign: currentCallsign, score: score };
            highScores.push(newScore);
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, 10);
            localStorage.setItem('uapInvadersScores', JSON.stringify(highScores));
            displayHighScores();
            
            // Check if it's a new record
            if (highScores[0].score === score && highScores[0].callsign === currentCallsign) {
                document.getElementById('newRecord').style.display = 'block';
            }
        }
        
        // Mouse controls
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
        });
        
        canvas.addEventListener('click', (e) => {
            if (gameRunning) {
                shoot();
            }
        });
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.code === 'F11') {
                e.preventDefault();
                toggleFullscreen();
            }
        });
        
        function shoot() {
            if (energy >= 10) {
                bullets.push({
                    x: player.x + player.width / 2,
                    y: player.y,
                    speed: 8
                });
                energy = Math.max(0, energy - 10);
                updateUI();
            }
        }
        
        function spawnEnemy() {
            const uapType = uapTypes[Math.floor(Math.random() * uapTypes.length)];
            enemies.push({
                x: Math.random() * (canvas.width - uapType.size),
                y: -uapType.size,
                width: uapType.size,
                height: uapType.size,
                speed: uapType.speed + Math.random() * 0.5,
                type: uapType,
                angle: 0,
                wobble: Math.random() * 2
            });
        }
        
        function updatePlayer() {
            // Smooth mouse following
            const targetX = mouseX - player.width / 2;
            const targetY = mouseY - player.height / 2;
            
            // Constrain to screen
            const constrainedX = Math.max(0, Math.min(canvas.width - player.width, targetX));
            const constrainedY = Math.max(0, Math.min(canvas.height - player.height, targetY));
            
            // Smooth movement
            player.x += (constrainedX - player.x) * 0.15;
            player.y += (constrainedY - player.y) * 0.15;
        }
        
        function updateBullets() {
            bullets = bullets.filter(bullet => {
                bullet.y -= bullet.speed;
                return bullet.y > -10;
            });
        }
        
        function updateEnemies() {
            enemies = enemies.filter(enemy => {
                enemy.y += enemy.speed;
                enemy.angle += enemy.wobble * 0.05;
                enemy.x += Math.sin(enemy.angle) * 0.5;
                
                if (enemy.y > canvas.height + enemy.height) {
                    health -= 5;
                    updateUI();
                    return false;
                }
                return true;
            });
            
            // Spawn new enemies
            const spawnRate = Math.min(0.03, 0.008 + score / 10000);
            if (Math.random() < spawnRate) {
                spawnEnemy();
            }
        }
        
        function updateStars() {
            stars.forEach(star => {
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = -5;
                    star.x = Math.random() * canvas.width;
                }
            });
        }
        
        function updateExplosions() {
            explosions = explosions.filter(explosion => {
                explosion.life--;
                explosion.radius += 0.5;
                return explosion.life > 0;
            });
        }
        
        function createExplosion(x, y) {
            explosions.push({
                x: x,
                y: y,
                radius: 0,
                life: 20,
                color: `hsl(${Math.random() * 60}, 100%, 50%)`
            });
        }
        
        function checkCollisions() {
            // Bullet-enemy collisions
            bullets.forEach((bullet, bIndex) => {
                enemies.forEach((enemy, eIndex) => {
                    const distance = Math.sqrt(
                        Math.pow(bullet.x - (enemy.x + enemy.width/2), 2) +
                        Math.pow(bullet.y - (enemy.y + enemy.height/2), 2)
                    );
                    
                    if (distance < enemy.width/2) {
                        bullets.splice(bIndex, 1);
                        enemies.splice(eIndex, 1);
                        score += enemy.type.points;
                        createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                        updateUI();
                    }
                });
            });
            
            // Player-enemy collisions
            enemies.forEach((enemy, index) => {
                const distance = Math.sqrt(
                    Math.pow(player.x + player.width/2 - (enemy.x + enemy.width/2), 2) +
                    Math.pow(player.y + player.height/2 - (enemy.y + enemy.height/2), 2)
                );
                
                if (distance < (player.width + enemy.width) / 3) {
                    enemies.splice(index, 1);
                    health -= 15;
                    createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                    updateUI();
                }
            });
        }
        
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('health').textContent = Math.max(0, health);
            document.getElementById('energy').textContent = Math.max(0, energy);
            
            document.getElementById('healthBar').style.width = Math.max(0, health) + 'px';
            document.getElementById('energyBar').style.width = Math.max(0, energy) + 'px';
            document.getElementById('scoreBar').style.width = Math.min(100, score / 10) + 'px';
            
            // Regenerate energy
            if (energy < 100 && gameRunning) {
                energy = Math.min(100, energy + 0.3);
            }
            
            // Check game over
            if (health <= 0) {
                gameOver();
            }
        }
        
        function gameOver() {
            gameRunning = false;
            saveHighScore();
            document.getElementById('finalCallsign').textContent = currentCallsign;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('newRecord').style.display = 'none';
            startGame();
        }
        
        function draw() {
            // Clear canvas with space-like background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#000011');
            gradient.addColorStop(1, '#000000');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw stars
            ctx.fillStyle = '#ffffff';
            stars.forEach(star => {
                ctx.globalAlpha = star.brightness;
                ctx.fillRect(star.x, star.y, 1, 1);
            });
            ctx.globalAlpha = 1;
            
            // Draw player
            ctx.font = '24px Arial';
            ctx.fillText('üöÄ', player.x, player.y + 20);
            
            // Draw enemies (UAPs)
            enemies.forEach(enemy => {
                ctx.save();
                ctx.translate(enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                ctx.rotate(enemy.angle * 0.1);
                ctx.font = enemy.type.size + 'px Arial';
                ctx.fillText(enemy.type.emoji, -enemy.width/2, enemy.height/4);
                ctx.restore();
            });
            
            // Draw bullets
            ctx.fillStyle = '#00ff00';
            bullets.forEach(bullet => {
                ctx.fillRect(bullet.x - 1, bullet.y, 2, 8);
                // Add glow effect
                ctx.shadowColor = '#00ff00';
                ctx.shadowBlur = 3;
                ctx.fillRect(bullet.x - 1, bullet.y, 2, 8);
                ctx.shadowBlur = 0;
            });
            
            // Draw explosions
            explosions.forEach(explosion => {
                ctx.save();
                ctx.globalAlpha = explosion.life / 20;
                ctx.strokeStyle = explosion.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(explosion.x, explosion.y, explosion.radius, 0, Math.PI * 2);
                ctx.stroke();
                ctx.restore();
            });
        }
        
        function gameLoop() {
            if (gameRunning) {
                updatePlayer();
                updateBullets();
                updateEnemies();
                updateExplosions();
                checkCollisions();
                updateUI();
            }
            
            updateStars();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Initialize and start
        initGame();
        showMenu(); // Show the menu screen on startup
        gameLoop();
    </script>
</body>
</html>